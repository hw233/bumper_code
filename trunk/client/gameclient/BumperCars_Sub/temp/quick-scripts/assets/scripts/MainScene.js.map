{"version":3,"sources":["MainScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import { MessagetType } from './MessageType';\r\nimport GlobalVar from './GlobalVar';\r\nimport WXHelper from './WXHelper';\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MainScene extends cc.Component\r\n{\r\n    @property(cc.Node)\r\n    groupRankList: cc.Node = null\r\n\r\n    @property(cc.Node)\r\n    friendRankList: cc.Node = null\r\n\r\n    protected onLoad () \r\n    {\r\n        var that = cc.view;\r\n\r\n        cc.view._convertPointWithScale = function(point) {\r\n            var viewport = that._viewPortRect;\r\n            point.x = (point.x - viewport.x) / (that._scaleX / 2);\r\n            point.y = (point.y - viewport.y) / (that._scaleY / 2);\r\n        }\r\n\r\n        cc.view._convertTouchesWithScale = function(touches) {\r\n            var viewport = that._viewPortRect, scaleX = that._scaleX / 2, scaleY = that._scaleY / 2, selTouch, selPoint, selPrePoint;\r\n            for (var i = 0; i < touches.length; i++) {\r\n                selTouch = touches[i];\r\n                selPoint = selTouch._point;\r\n                selPrePoint = selTouch._prevPoint;\r\n                selPoint.x = (selPoint.x - viewport.x) / scaleX;\r\n                selPoint.y = (selPoint.y - viewport.y) / scaleY;\r\n                selPrePoint.x = (selPrePoint.x - viewport.x) / scaleX;\r\n                selPrePoint.y = (selPrePoint.y - viewport.y) / scaleY;\r\n            }\r\n        }\r\n    }\r\n\r\n    start () {\r\n        var self = this;\r\n\r\n        cc.log(\"子域场景运行\");\r\n\r\n        this.loadRes();\r\n\r\n        this.hideAllLayer();\r\n\r\n        wx.onMessage(data => {\r\n            cc.log(\"接收主域发来消息：\", data);\r\n            \r\n            if(data.messageType == MessagetType.MT_FriendRankList)\r\n            {\r\n                //好友排行榜\r\n                GlobalVar.rankType = parseInt(data.rankType);\r\n                self.showFetchFriendRankList();\r\n            }else if(data.messageType == MessagetType.MT_OverRankList)\r\n            {\r\n                //游戏结束界面排行榜\r\n            }else if(data.messageType == MessagetType.MT_JJCYPlayer)\r\n            {\r\n                //即将超越的玩家\r\n            }else if(data.messageType == MessagetType.MT_GroupRankList)\r\n            {\r\n                //群排行榜\r\n                GlobalVar.rankType = data.rankType;\r\n                GlobalVar.groupShareTicket = data.groupShareTicket;\r\n                self.showGroupRankList();\r\n            }else if(data.messageType == MessagetType.MT_UpdateJJCYPlayer)\r\n            {\r\n            }\r\n            else if(data.messageType == MessagetType.MT_FriendRankList)\r\n            {\r\n                //清理\r\n                self.clear();\r\n            }\r\n        });\r\n\r\n        //获取自己的用户信息成功\r\n        var getUserInfoSuccess = function(res){\r\n            cc.log(\"获取用户信息成功--->>>\", res);\r\n\r\n            GlobalVar.avatarUrl = res.data[0].avatarUrl;\r\n        };\r\n\r\n        WXHelper.GetUseInfo(getUserInfoSuccess);\r\n    }\r\n\r\n    //显示好友排行榜\r\n    private showFetchFriendRankList()\r\n    {\r\n        this.hideAllLayer();\r\n\r\n        var friendRankListCom = this.friendRankList.getComponent(\"FriendRankList\");\r\n        if(friendRankListCom){\r\n            friendRankListCom.show();\r\n        }\r\n\r\n        this.friendRankList.active = true;\r\n    }\r\n\r\n    //显示群排行榜\r\n    private showGroupRankList()\r\n    {\r\n        this.hideAllLayer();\r\n\r\n        var groupRankListCom = this.groupRankList.getComponent(\"GroupRankList\");\r\n        if(groupRankListCom)\r\n        {\r\n            groupRankListCom.show();\r\n        }\r\n\r\n        this.groupRankList.active = true;\r\n    }\r\n\r\n    private loadRes()\r\n    {\r\n        cc.loader.loadRes(\"subdomain\", cc.SpriteAtlas, function (err, texture) {\r\n            cc.log(\"子域资源加载完成\");\r\n        });\r\n    }\r\n\r\n    private hideAllLayer(){\r\n        if(this.groupRankList)\r\n        {\r\n            this.groupRankList.active = false;\r\n        }\r\n\r\n        if(this.friendRankList)\r\n        {\r\n            this.friendRankList.active = false;\r\n        }\r\n    }\r\n\r\n    private clear(){\r\n        var groupRankListCom = this.groupRankList.getComponent(\"GroupRankList\");\r\n        if(groupRankListCom)\r\n        {\r\n            groupRankListCom.clear();\r\n        }\r\n\r\n        var friendRankListCom = this.friendRankList.getComponent(\"FriendRankList\");\r\n        if(friendRankListCom)\r\n        {\r\n            friendRankListCom.clear();\r\n        }\r\n    }\r\n}"]}